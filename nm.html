<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cookbook — Your Virtual Kitchen Assistant</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#f59e0b; --glass: rgba(255,255,255,0.04);
      --radius:14px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#071024 0%, #071833 60%);color:#e6eef6;min-height:100vh;}
    .app{max-width:1100px;margin:32px auto;padding:28px;border-radius:20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow: 0 8px 30px rgba(2,6,23,0.6);}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .logo{display:flex;align-items:center;gap:14px}
    .logo .icon{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#ef4444);display:grid;place-items:center;font-weight:700;color:#071024}
    h1{font-size:20px;margin:0}
    .subtitle{color:var(--muted);font-size:13px}

    .controls{display:flex;gap:12px;align-items:center;margin-top:18px}
    .search{flex:1;display:flex}
    .search input{flex:1;padding:12px 14px;border-radius:12px;border:none;background:var(--glass);color:inherit}
    .btn{padding:10px 14px;border-radius:12px;background:var(--accent);border:none;color:#071024;font-weight:600;cursor:pointer}
    .secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px}

    main{display:grid;grid-template-columns:380px 1fr;gap:20px;margin-top:20px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:16px;border-radius:14px}

    /* left column */
    .recipe-list{display:flex;flex-direction:column;gap:10px;max-height:64vh;overflow:auto;padding-right:6px}
    .recipe-item{display:flex;gap:12px;align-items:center;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);cursor:pointer}
    .recipe-item:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,0.35)}
    .thumb{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#ffd29b,#ff7a7a);display:grid;place-items:center;font-weight:700;color:#071024}
    .meta{flex:1}
    .meta small{color:var(--muted)}

    /* right column */
    .viewer{padding:16px;border-radius:12px}
    .viewer h2{margin:0 0 6px 0}
    .tags{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
    .tag{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px;color:var(--muted)}
    .section{margin-top:14px}
    .ingredients li, .steps li{margin-bottom:8px}

    .row{display:flex;gap:8px;align-items:center}
    label{font-size:13px;color:var(--muted)}
    input[type=number]{width:80px;padding:6px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);color:inherit}

    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

    /* responsive */
    @media (max-width:920px){main{grid-template-columns:1fr;}
      .logo h1{display:none}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">
        <div class="icon">CK</div>
        <div>
          <h1>Cookbook — Your Virtual Kitchen Assistant</h1>
          <div class="subtitle">Store recipes, scale ingredients, set timers and get quick suggestions</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="exportBtn" class="secondary">Export JSON</button>
        <button id="importBtn" class="secondary">Import JSON</button>
        <input id="fileInput" type="file" accept="application/json" style="display:none" />
      </div>
    </header>

    <div class="controls">
      <div class="search">
        <input id="search" placeholder="Search recipes, ingredients, tags..." />
      </div>
      <button id="randomSuggest" class="secondary">Suggest</button>
      <button id="newRecipe" class="btn">+ New Recipe</button>
    </div>

    <main>
      <aside class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <strong>Recipes</strong>
          <small id="count">0</small>
        </div>
        <div class="recipe-list" id="recipeList"></div>
      </aside>

      <section class="panel viewer" id="viewer">
        <div id="empty" style="text-align:center;padding:40px;color:var(--muted)">Select a recipe or click <strong>+ New Recipe</strong></div>

        <div id="recipeCard" style="display:none">
          <div class="row" style="justify-content:space-between">
            <div>
              <h2 id="rTitle"></h2>
              <div class="tags" id="rTags"></div>
            </div>
            <div style="text-align:right">
              <button id="editBtn" class="secondary">Edit</button>
              <button id="deleteBtn" class="secondary">Delete</button>
            </div>
          </div>

          <div class="section">
            <label>Servings</label>
            <div class="row" style="margin-top:6px">
              <input type="number" id="servingsInput" min="1" value="1" />
              <div style="flex:1"></div>
              <button id="startTimer" class="secondary">Start Timer</button>
            </div>
          </div>

          <div class="section">
            <strong>Ingredients</strong>
            <ul class="ingredients" id="ingredients"></ul>
          </div>

          <div class="section">
            <strong>Steps</strong>
            <ol class="steps" id="steps"></ol>
          </div>

          <div class="section row" style="justify-content:space-between">
            <div>
              <small class="subtitle">Last edited: <span id="lastEdited"></span></small>
            </div>
            <div>
              <button id="scaleDown" class="secondary">-</button>
              <button id="scaleUp" class="secondary">+</button>
            </div>
          </div>
        </div>

        <!-- Editor modal (simple, inline) -->
        <div id="editor" style="display:none;margin-top:12px">
          <div style="display:flex;gap:8px;margin-bottom:8px">
            <input id="titleInput" placeholder="Recipe title" style="flex:1;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.02)" />
            <input id="tagsInput" placeholder="tags (comma separated)" style="width:220px;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.02)" />
          </div>

          <div style="display:flex;gap:8px;margin-bottom:8px">
            <textarea id="ingredientsInput" rows="4" placeholder="Ingredients (one per line, start with quantity and unit if possible)" style="flex:1;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.02)"></textarea>
            <textarea id="stepsInput" rows="4" placeholder="Steps (one step per line)" style="flex:1;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.02)"></textarea>
          </div>

          <div style="display:flex;gap:8px;justify-content:flex-end">
            <button id="cancelEdit" class="secondary">Cancel</button>
            <button id="saveRecipe" class="btn">Save</button>
          </div>
        </div>

      </section>
    </main>

    <footer>Made with ❤️ — tips: use the <strong>Suggest</strong> button for quick recipe picks. Recipes persist in your browser.</footer>
  </div>

  <script>
    // Simple client-side cookbook app
    const STORAGE_KEY = 'cookbook_v1';
    let recipes = [];
    let selectedId = null;

    // DOM refs
    const recipeList = document.getElementById('recipeList');
    const countEl = document.getElementById('count');
    const viewer = document.getElementById('viewer');
    const empty = document.getElementById('empty');
    const recipeCard = document.getElementById('recipeCard');
    const rTitle = document.getElementById('rTitle');
    const rTags = document.getElementById('rTags');
    const ingredientsEl = document.getElementById('ingredients');
    const stepsEl = document.getElementById('steps');
    const lastEdited = document.getElementById('lastEdited');
    const servingsInput = document.getElementById('servingsInput');

    const editor = document.getElementById('editor');
    const titleInput = document.getElementById('titleInput');
    const tagsInput = document.getElementById('tagsInput');
    const ingredientsInput = document.getElementById('ingredientsInput');
    const stepsInput = document.getElementById('stepsInput');

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        recipes = raw ? JSON.parse(raw) : [];
      }catch(e){console.error(e);recipes=[]}
      renderList();
    }

    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(recipes));
      renderList();
    }

    function renderList(filter=''){
      recipeList.innerHTML='';
      const filtered = recipes.filter(r=>{
        if(!filter) return true;
        const s = filter.toLowerCase();
        return r.title.toLowerCase().includes(s) || (r.tags||[]).some(t=>t.includes(s)) || (r.ingredientsText||'').toLowerCase().includes(s);
      });
      countEl.textContent = filtered.length;
      filtered.forEach(r=>{
        const el = document.createElement('div'); el.className='recipe-item';
        el.dataset.id = r.id;
        el.innerHTML = `<div class="thumb">${r.title.slice(0,2).toUpperCase()}</div><div class="meta"><strong>${r.title}</strong><br><small>${(r.tags||[]).join(', ')}</small></div>`;
        el.addEventListener('click', ()=>selectRecipe(r.id));
        recipeList.appendChild(el);
      })
    }

    function selectRecipe(id){
      selectedId = id;
      const r = recipes.find(x=>x.id===id);
      if(!r) return;
      empty.style.display='none';
      recipeCard.style.display='block';
      editor.style.display='none';
      rTitle.textContent = r.title;
      rTags.innerHTML = '';
      (r.tags||[]).forEach(t=>{const sp=document.createElement('div');sp.className='tag';sp.textContent=t; rTags.appendChild(sp)});
      servingsInput.value = r.servings || 1;
      renderIngredients(r);
      renderSteps(r);
      lastEdited.textContent = new Date(r.updatedAt).toLocaleString();
    }

    function renderIngredients(r){
      ingredientsEl.innerHTML='';
      (r.ingredients||[]).forEach(it=>{
        const li = document.createElement('li');
        li.textContent = it; ingredientsEl.appendChild(li);
      })
    }
    function renderSteps(r){
      stepsEl.innerHTML='';
      (r.steps||[]).forEach(st=>{const li=document.createElement('li');li.textContent=st;stepsEl.appendChild(li)})
    }

    // scaling: naive scale by multiplier on numeric prefix
    function scaleIngredients(multiplier){
      if(!selectedId) return;
      const r = recipes.find(x=>x.id===selectedId);
      if(!r) return;
      r.ingredients = r.ingredients.map(line=>{
        // try to find leading number (supports simple fractions like 1/2)
        const match = line.trim().match(/^([0-9]+(?:\/[0-9]+)?(?:\.[0-9]+)?)(\s*)(.*)$/);
        if(match){
          let numStr = match[1];
          let num = 0;
          if(numStr.includes('/')){ const [a,b]=numStr.split('/').map(Number); if(b) num = a/b; }
          else num = parseFloat(numStr);
          if(isNaN(num)) return line;
          let newNum = Math.round((num * multiplier) * 100)/100;
          // format fraction-ish if integral small denom
          return `${newNum} ${match[3]}`;
        }
        return line;
      });
      r.updatedAt = Date.now();
      save();
      selectRecipe(selectedId);
    }

    // create new recipe
    function newRecipe(){
      const r = {id: 'r_'+Date.now(), title:'Untitled Recipe', tags:[], ingredients: ['1 cup example ingredient'], ingredientsText:'', steps:['Example step'], servings:1, updatedAt:Date.now()};
      recipes.unshift(r);
      save();
      selectRecipe(r.id);
      // open editor
      editRecipe(r.id);
    }

    function editRecipe(id){
      const r = recipes.find(x=>x.id===id);
      if(!r) return;
      editor.style.display='block';
      recipeCard.style.display='none';
      titleInput.value = r.title;
      tagsInput.value = (r.tags||[]).join(', ');
      ingredientsInput.value = (r.ingredients||[]).join('\n');
      stepsInput.value = (r.steps||[]).join('\n');
      saveRecipeBtn.dataset.id = id;
    }

    function deleteRecipe(id){
      if(!confirm('Delete this recipe?')) return;
      recipes = recipes.filter(x=>x.id!==id);
      save();
      selectedId = null;
      recipeCard.style.display='none';
      empty.style.display='block';
    }

    // quick suggest
    function randomSuggest(){
      if(recipes.length===0) return alert('No recipes yet — click + New Recipe');
      const r = recipes[Math.floor(Math.random()*recipes.length)];
      selectRecipe(r.id);
      // small flourish
      recipeCard.style.border = '1px solid rgba(245,158,11,0.15)';
      setTimeout(()=>recipeCard.style.border='none',800);
    }

    // Export / Import
    function exportJSON(){
      const data = JSON.stringify(recipes, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='cookbook_export.json'; a.click(); URL.revokeObjectURL(url);
    }
    function importJSON(file){
      const reader = new FileReader();
      reader.onload = e => {
        try{
          const parsed = JSON.parse(e.target.result);
          if(Array.isArray(parsed)){
            recipes = parsed.concat(recipes);
            save();
            alert('Imported '+parsed.length+' recipes');
          } else alert('Invalid format');
        }catch(err){alert('Failed to import: '+err.message)}
      }
      reader.readAsText(file);
    }

    // event wiring
    document.getElementById('newRecipe').addEventListener('click', newRecipe);
    document.getElementById('randomSuggest').addEventListener('click', randomSuggest);
    document.getElementById('search').addEventListener('input', e=>renderList(e.target.value));
    document.getElementById('deleteBtn').addEventListener('click', ()=>{ if(selectedId) deleteRecipe(selectedId)});
    document.getElementById('editBtn').addEventListener('click', ()=>{ if(selectedId) editRecipe(selectedId)});

    const saveRecipeBtn = document.getElementById('saveRecipe');
    saveRecipeBtn.addEventListener('click', ()=>{
      const id = saveRecipeBtn.dataset.id;
      const r = recipes.find(x=>x.id===id);
      if(!r) return;
      r.title = titleInput.value || 'Untitled Recipe';
      r.tags = tagsInput.value.split(',').map(s=>s.trim()).filter(Boolean);
      r.ingredients = ingredientsInput.value.split('\n').map(s=>s.trim()).filter(Boolean);
      r.ingredientsText = ingredientsInput.value;
      r.steps = stepsInput.value.split('\n').map(s=>s.trim()).filter(Boolean);
      r.updatedAt = Date.now();
      save();
      selectRecipe(id);
      editor.style.display='none';
      recipeCard.style.display='block';
    });

    document.getElementById('cancelEdit').addEventListener('click', ()=>{editor.style.display='none';recipeCard.style.display='block'});

    document.getElementById('scaleUp').addEventListener('click', ()=>scaleIngredients(1.25));
    document.getElementById('scaleDown').addEventListener('click', ()=>scaleIngredients(0.8));

    document.getElementById('startTimer').addEventListener('click', ()=>{
      const minutes = parseInt(prompt('Set timer (minutes):', '10'))||0;
      if(minutes>0){
        alert('Timer started for '+minutes+' minutes — you will get a browser alert when it ends.');
        setTimeout(()=>alert('⏰ Timer finished ('+minutes+' min)'), minutes*60*1000);
      }
    });

    document.getElementById('exportBtn').addEventListener('click', exportJSON);
    document.getElementById('importBtn').addEventListener('click', ()=>document.getElementById('fileInput').click());
    document.getElementById('fileInput').addEventListener('change', e=>{if(e.target.files[0]) importJSON(e.target.files[0]);});

    // initialize with sample recipes if empty
    function seed(){
      if(recipes.length===0){
        recipes = [
          {id:'r_pancakes',title:'Fluffy Pancakes',tags:['breakfast','sweet'],ingredients:['1 cup flour','1 cup milk','1 egg','2 tbsp sugar','1 tsp baking powder'],ingredientsText:'1 cup flour\n1 cup milk\n1 egg\n2 tbsp sugar\n1 tsp baking powder',steps:['Mix dry ingredients','Whisk in milk and egg','Cook on a hot pan 2-3 min each side'],servings:2,updatedAt:Date.now()},
          {id:'r_tomato_pasta',title:'Quick Tomato Pasta',tags:['dinner','vegetarian'],ingredients:['200 g pasta','1 cup tomato sauce','1 clove garlic','1 tbsp olive oil','salt to taste'],ingredientsText:'200 g pasta\n1 cup tomato sauce\n1 clove garlic\n1 tbsp olive oil\nsalt to taste',steps:['Boil pasta','Saute garlic in oil','Add sauce and combine with pasta'],servings:2,updatedAt:Date.now()}
        ];
        save();
      }
    }

    // load app
    load(); seed();
  </script>
</body>
</html>s